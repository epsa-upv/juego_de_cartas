<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Home - Oh Hell!</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>

<div class="page-container">

    <nav class="navbar">
        <div class="container navbar-content">
            <span class="navbar-brand">ðŸŽ´ OH HELL!</span>
            <button class="btn btn-danger btn-sm" onclick="logout()">Salir</button>
        </div>
    </nav>

    <div class="content-wrapper">
        <div class="home-container">
            <h1 class="home-title">OH HELL!</h1>

            <div class="home-actions">
                <button id="crear-btn" class="btn btn-primary btn-lg btn-full" onclick="crearPartida()">
                    ðŸŽ® Crear Partida
                </button>
            </div>
        </div>
    </div>

</div>

<script>
    const token = localStorage.getItem('token');
    if (!token) location.href = 'login.html';

    async function crearPartida() {
        const btn = document.getElementById('crear-btn');
        btn.disabled = true;

        try {
            const res = await fetch(
                '/ohhell-api/api/games',
                {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title: 'Partida MVP' })
                }
            );

            if (!res.ok) {
                const err = await res.json().catch(() => ({}));
                alert(err.message || 'No se pudo crear la partida');
                btn.disabled = false;
                return;
            }

            const game = await res.json();
            location.href = `waiting-room.html?gameId=${game.id}`;
        } catch (e) {
            console.error(e);
            alert('Error de conexiÃ³n al crear la partida');
            document.getElementById('crear-btn').disabled = false;
        }
    }

    function logout() {
        localStorage.clear();
        location.href = 'login.html';
    }
</script>

</body>
</html>
